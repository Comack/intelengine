syntax = "proto3";

package worldmonitor.intelligence.v1;

import "sebuf/http/annotations.proto";
import "worldmonitor/intelligence/v1/get_risk_scores.proto";
import "worldmonitor/intelligence/v1/get_pizzint_status.proto";
import "worldmonitor/intelligence/v1/classify_event.proto";
import "worldmonitor/intelligence/v1/get_country_intel_brief.proto";
import "worldmonitor/intelligence/v1/search_gdelt_documents.proto";
import "worldmonitor/intelligence/v1/run_forensics_shadow.proto";
import "worldmonitor/intelligence/v1/list_fused_signals.proto";
import "worldmonitor/intelligence/v1/list_calibrated_anomalies.proto";
import "worldmonitor/intelligence/v1/get_forensics_trace.proto";
import "worldmonitor/intelligence/v1/get_forensics_run.proto";
import "worldmonitor/intelligence/v1/list_forensics_runs.proto";
import "worldmonitor/intelligence/v1/get_forensics_policy.proto";
import "worldmonitor/intelligence/v1/get_forensics_topology_summary.proto";
import "worldmonitor/intelligence/v1/forensics.proto";

// IntelligenceService provides APIs for cross-domain intelligence synthesis including
// risk scores, PizzINT monitoring, GDELT tension analysis, and AI-powered classification.
service IntelligenceService {
  option (sebuf.http.service_config) = {base_path: "/api/intelligence/v1"};

  // GetRiskScores retrieves composite instability and strategic risk assessments.
  rpc GetRiskScores(GetRiskScoresRequest) returns (GetRiskScoresResponse) {
    option (sebuf.http.config) = {path: "/get-risk-scores"};
  }

  // GetPizzintStatus retrieves Pentagon Pizza Index and GDELT tension pair data.
  rpc GetPizzintStatus(GetPizzintStatusRequest) returns (GetPizzintStatusResponse) {
    option (sebuf.http.config) = {path: "/get-pizzint-status"};
  }

  // ClassifyEvent classifies a real-world event using AI (Groq).
  rpc ClassifyEvent(ClassifyEventRequest) returns (ClassifyEventResponse) {
    option (sebuf.http.config) = {path: "/classify-event"};
  }

  // GetCountryIntelBrief generates an AI intelligence brief for a country (OpenRouter).
  rpc GetCountryIntelBrief(GetCountryIntelBriefRequest) returns (GetCountryIntelBriefResponse) {
    option (sebuf.http.config) = {path: "/get-country-intel-brief"};
  }

  // SearchGdeltDocuments searches the GDELT 2.0 Doc API for news articles.
  rpc SearchGdeltDocuments(SearchGdeltDocumentsRequest) returns (SearchGdeltDocumentsResponse) {
    option (sebuf.http.config) = {path: "/search-gdelt-documents"};
  }

  // RunForensicsShadow executes deterministic shadow forensics orchestration.
  rpc RunForensicsShadow(RunForensicsShadowRequest) returns (RunForensicsShadowResponse) {
    option (sebuf.http.config) = {path: "/run-forensics-shadow"};
  }

  // ListFusedSignals returns weak-supervision fusion outputs for a run/domain.
  rpc ListFusedSignals(ListFusedSignalsRequest) returns (ListFusedSignalsResponse) {
    option (sebuf.http.config) = {path: "/list-fused-signals"};
  }

  // ListCalibratedAnomalies returns conformal anomaly outputs for a run/domain.
  rpc ListCalibratedAnomalies(ListCalibratedAnomaliesRequest) returns (ListCalibratedAnomaliesResponse) {
    option (sebuf.http.config) = {path: "/list-calibrated-anomalies"};
  }

  // GetForensicsTrace returns phase-level trace data for a run.
  rpc GetForensicsTrace(GetForensicsTraceRequest) returns (GetForensicsTraceResponse) {
    option (sebuf.http.config) = {path: "/get-forensics-trace"};
  }

  // GetForensicsRun returns run metadata and aggregate output counts.
  rpc GetForensicsRun(GetForensicsRunRequest) returns (GetForensicsRunResponse) {
    option (sebuf.http.config) = {path: "/get-forensics-run"};
  }

  // ListForensicsRuns returns recent run summaries for observability.
  rpc ListForensicsRuns(ListForensicsRunsRequest) returns (ListForensicsRunsResponse) {
    option (sebuf.http.config) = {path: "/list-forensics-runs"};
  }

  // GetForensicsPolicy returns learned phase-order policy rows.
  rpc GetForensicsPolicy(GetForensicsPolicyRequest) returns (GetForensicsPolicyResponse) {
    option (sebuf.http.config) = {path: "/get-forensics-policy"};
  }

  // GetForensicsTopologySummary returns topology alerts, trends, and baselines.
  rpc GetForensicsTopologySummary(GetForensicsTopologySummaryRequest) returns (GetForensicsTopologySummaryResponse) {
    option (sebuf.http.config) = {path: "/get-forensics-topology-summary"};
  }

  // SubmitForensicsFeedback allows users to provide semi-supervised feedback.
  rpc SubmitForensicsFeedback(SubmitForensicsFeedbackRequest) returns (SubmitForensicsFeedbackResponse) {
    option (sebuf.http.config) = {path: "/submit-forensics-feedback"};
  }

  // ExplainAnomaly provides an AI explanation based on vectorized evidence.
  rpc ExplainAnomaly(ExplainAnomalyRequest) returns (ExplainAnomalyResponse) {
    option (sebuf.http.config) = {path: "/explain-anomaly"};
  }
}
