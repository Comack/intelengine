syntax = "proto3";

package worldmonitor.intelligence.v1;

import "buf/validate/validate.proto";
import "worldmonitor/intelligence/v1/forensics.proto";

// ListCalibratedAnomaliesRequest retrieves calibrated anomalies for a run/domain.
message ListCalibratedAnomaliesRequest {
  // Optional run id. Empty means latest run for domain.
  string run_id = 1;
  // Optional domain filter.
  string domain = 2;
  // If true, return only entries flagged as anomalies.
  bool anomalies_only = 3;
  // Maximum results to return (1-500). Zero uses server default.
  int32 limit = 4 [
    (buf.validate.field).int32.gte = 0,
    (buf.validate.field).int32.lte = 500
  ];
  // Optional signal type filter.
  string signal_type = 5;
  // Optional region filter.
  string region = 6;
  // Optional maximum p-value filter (0-1). Zero disables this filter.
  double max_p_value = 7 [
    (buf.validate.field).double.gte = 0,
    (buf.validate.field).double.lte = 1
  ];
  // Optional minimum absolute legacy z-score filter.
  double min_abs_legacy_z_score = 8 [
    (buf.validate.field).double.gte = 0
  ];
}

// ListCalibratedAnomaliesResponse contains calibrated anomaly outputs.
message ListCalibratedAnomaliesResponse {
  // Run metadata for returned data.
  ForensicsRunMetadata run = 1;
  // Calibrated anomalies.
  repeated ForensicsCalibratedAnomaly anomalies = 2;
  // Error message if retrieval failed.
  string error = 3;
}
